## Modulo de instalación de modulos extras de kubernetes
## Es necesario disponer de un cluster de kubernetes.
## Existe una variable tipo flag que decide si se instala  o no el modulo, por ejemplo
##
##  install_alb_ingress = true|false.
##
##  Las instalaciones se realizan a través de Helm. Existe un modulo de tiller, que se tiene que  instalar en primer caso.
##   Para instalar el alb-ingress es importante tener correctamente etiquetado las subnedes correspondientes como se indica en la documentación:
##    https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html
## 



## Providers

| Name | Version |
|------|---------|
| aws | n/a |
| helm | n/a |
| kubernetes | n/a |
| template | n/a |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:-----:|
| alb\_ingress\_container\_image\_tag | n/a | `string` | `"v1.1.3"` | no |
| alb\_ingress\_resource\_limits\_cpu | CPU limits for ALB Ingress controller | `string` | `"100m"` | no |
| alb\_ingress\_resource\_limits\_mem | Memory limits for ALB Ingress controller | `string` | `"128Mi"` | no |
| alb\_ingress\_resource\_requests\_cpu | CPU requested for ALB Ingress controller | `string` | `"100m"` | no |
| alb\_ingress\_resource\_requests\_mem | Memory requested for ALB Ingress controller | `string` | `"128Mi"` | no |
| autoscaler\_iam\_policy\_arn | The ARN of the policy to assign to autoscaler, required when `install_autoscaler = true` | `string` | `""` | no |
| aws\_account\_id | The id of the AWS account thay owns the cluster | `string` | `"606042811316"` | no |
| aws\_region | The AWS region where the cluster lives | `string` | `"eu-west-1"` | no |
| cluster\_name | The name of the cluster | `string` | n/a | yes |
| config\_output\_path | Where to save files generated by this module | `string` | `"./"` | no |
| depend\_on | Module eks dependency variable | `any` | n/a | yes |
| enable\_kms\_encyption | Whether to enable encryption at rest with a CMK | `bool` | `false` | no |
| environment | The name of the environment | `string` | `"dev"` | no |
| etcd\_container\_image\_tag | n/a | `string` | `"v3.2.26"` | no |
| external\_dns\_domain\_filters | String used to filter hosted zones where external dns shuold create records. Not needed unless install\_external\_dns = true | `string` | `""` | no |
| external\_dns\_helm\_chart\_version | n/a | `string` | `"2.9.3"` | no |
| external\_dns\_record\_policy | n/a | `string` | `"upsert-only"` | no |
| files\_path | The path to this module, relative to the root of the configuration. If set to empty string, will default to path.module | `string` | `"../Modules/eks/modules/kubernetes-extras/"` | no |
| fs\_id | n/a | `any` | n/a | yes |
| grafana\_admin\_password | Grafana admin password | `string` | `"admin"` | no |
| grafana\_helm\_chart\_version | n/a | `string` | `"3.10.2"` | no |
| grafana\_helm\_values | Any additional Helm values to specify to Grafana | `list(string)` | `[]` | no |
| hlem\_release\_force\_update | Whether to have helm force an update when needed | `bool` | `true` | no |
| install\_alb\_ingress | n/a | `bool` | `true` | no |
| install\_dashboard | n/a | `bool` | `true` | no |
| install\_efs\_provisioner | n/a | `bool` | `false` | no |
| install\_external\_dns | n/a | `bool` | `false` | no |
| install\_grafana | n/a | `bool` | `false` | no |
| install\_helm | n/a | `bool` | `true` | no |
| install\_istio | n/a | `bool` | `false` | no |
| install\_metrics\_server | n/a | `bool` | `true` | no |
| install\_prometheus | n/a | `bool` | `false` | no |
| install\_prometheus\_operator | n/a | `bool` | `false` | no |
| is\_eks | ######################### Service install switches ######################### | `string` | `"true"` | no |
| istio\_alb\_ingress\_cognito\_user\_pool\_arn | n/a | `string` | `""` | no |
| istio\_alb\_ingress\_cognito\_user\_pool\_custom\_domain\_name | n/a | `string` | `""` | no |
| istio\_alb\_ingress\_cognito\_user\_pool\_default\_client\_id | n/a | `string` | `""` | no |
| istio\_alb\_ingress\_enable\_cognito\_auth | n/a | `bool` | `false` | no |
| istio\_alb\_ingress\_external\_dns\_name | External DNS name mapping to an ALB used for istio or alb ingress setup. Not needed unless install\_alb = true or install\_alb\_ingress = true | `string` | `""` | no |
| istio\_alb\_ingress\_helm\_values | The text to be appended to the helm chart values supplied to the helm release | `string` | `""` | no |
| istio\_alb\_ingress\_logs\_s3\_bucket | n/a | `string` | `""` | no |
| istio\_alb\_ingress\_logs\_s3\_enabled | n/a | `bool` | `false` | no |
| istio\_alb\_ingress\_logs\_s3\_object\_prefix | n/a | `string` | `""` | no |
| istio\_alb\_ingress\_manifest\_file | The local path where the Istio ALB Ingress manifest is stored | `string` | `"istio-alb-ingress.yaml"` | no |
| istio\_alb\_ingress\_security\_group\_ids | n/a | `list(string)` | `[]` | no |
| istio\_alb\_ingress\_subnets | List of subnets where alb controller can attached load balancers. Not needed unless install\_alb = true or install\_alb\_ingress = true | `list(string)` | `[]` | no |
| istio\_alb\_ingress\_target\_type | n/a | `string` | `"ip"` | no |
| istio\_alb\_ingress\_tls\_certificate\_arn | n/a | `string` | `""` | no |
| istio\_config\_validation\_enabled | Whether to disable istio's ValidatingWebhookConfiguration. It is handy to disable validation for upgrades and slow clusters (because of timeouts). | `bool` | `false` | no |
| istio\_container\_image\_tag | n/a | `string` | `"1.4.6"` | no |
| istio\_helm\_chart\_version | n/a | `string` | `"1.4.6"` | no |
| istio\_helm\_values | Any additional Helm values to specify to Istio Helm release | `list(string)` | `[]` | no |
| istio\_mtls\_auto | Whether to configure istio with Automatic mTLS | `string` | `false` | no |
| istio\_mtls\_enabled | Whether to configure istio with mTLS enabled | `string` | `false` | no |
| istio\_sidecar\_injector\_enabled | Whether to configure istio with sidecar injector | `bool` | `true` | no |
| istio\_sidecar\_injector\_exclusion\_label | A label that, when present on a resource, instructs isito not to inject a sidecar on that resource. See https://istio.io/docs/setup/additional-setup/sidecar-injection/#more-control-adding-exceptions | `string` | `"k8s-xtrs.osdevex.gitlab.com/istio-disable-sidecar"` | no |
| kubeconfig\_file | The path to the kubeconfig file | `string` | `"/home/ubuntu/.kube/"` | no |
| oidc\_provider\_url | The URL (without scheme) of the OpenID Connect provider of the cluster, required when `pod_iam_policy_mode = "iam-oidc"` | `string` | `""` | no |
| pod\_iam\_policy\_mode | The way IAM policies are assigned to pods that need it. Possible values are 'kube2iam' (will trigger the installation of kube2iam) or 'iam-oidc' (for clusters that support and have it enabled, will trigger creation of service accounts). | `string` | `"iam-oidc"` | no |
| project | The name of the project | `string` | `"arqref"` | no |
| prometheus\_helm\_chart\_version | n/a | `string` | `"9.1.2"` | no |
| prometheus\_helm\_values | Any additional Helm values to specify to Prometheus | `list(string)` | `[]` | no |
| prometheus\_operator\_helm\_chart\_version | n/a | `string` | `"8.7.0"` | no |
| prometheus\_operator\_helm\_values | Any additional Helm values to specify to Prometheus | `list(string)` | `[]` | no |
| tags | Tags to be added to all reosurces that take it | `map(string)` | `{}` | no |
| tiller\_container\_image\_tag | n/a | `string` | `"v2.15.2"` | no |
| tiller\_deploy\_namespace | The namespace where tiller-deploy is installed | `string` | `"kube-system"` | no |
| tiller\_deploy\_service\_account\_name | The name for the tiller-deploy service account | `string` | `"tiller"` | no |
| vpc\_id | n/a | `string` | `""` | no |
| worker\_nodes\_security\_group\_id | n/a | `string` | `""` | no |
| worker\_subnet\_ids | n/a | `list(string)` | `[]` | no |
| workers\_iam\_role\_name | n/a | `string` | `""` | no |

## Outputs

No output.

